# Scribe Component Overview

## 🧩 Component Interaction Map

This document provides a detailed overview of how all Scribe components interact with each other.

## 🔄 Core Processing Components

### 1. Command Line Interface (`scribe_cli.py`)
**Purpose**: Entry point for all system operations
**Key Functions**:
- `add`: Add media files to processing queue
- `process`: Run full transcription/translation pipeline
- `transcribe`: Audio/video to text conversion
- `translate`: Multi-language translation
- `evaluate`: Quality assessment
- `status`: System status and progress
- `backup`: System backup and restore

**Interactions**:
- → `Pipeline`: Orchestrates processing workflows
- → `Database`: Tracks file status and metadata
- → `Backup`: Creates system snapshots

### 2. Pipeline Orchestrator (`scribe/pipeline.py`)
**Purpose**: Coordinates all processing steps
**Key Classes**:
- `Pipeline`: Main orchestration class
- `PipelineConfig`: Configuration management
- `PipelineResult`: Processing results tracking

**Key Methods**:
- `scan_input_files()`: Discover media files
- `add_files_to_database()`: Register new files
- `process_transcriptions()`: Coordinate transcription
- `process_translations()`: Coordinate translation
- `evaluate_translations()`: Quality assessment
- `run_full_pipeline()`: Complete workflow

**Interactions**:
- → `Transcribe`: Audio/video processing
- → `Translate`: Multi-language conversion
- → `Evaluate`: Quality scoring
- → `Database`: Status tracking
- → `Utils`: File operations

### 3. Transcription Engine (`scribe/transcribe.py`)
**Purpose**: Convert audio/video to text using ElevenLabs
**Key Functions**:
- `transcribe_file()`: Main transcription function
- `generate_srt()`: Create subtitle files
- `validate_transcription()`: Quality checks

**External Dependencies**:
- ElevenLabs Scribe API
- FFmpeg for audio processing

**Interactions**:
- ← `Pipeline`: Receives transcription requests
- → `Database`: Updates transcription status
- → `Utils`: File I/O operations

### 4. Translation Engine (`scribe/translate.py`)
**Purpose**: Multi-language translation with provider routing
**Key Functions**:
- `translate_text()`: Main translation function
- `translate_srt_file()`: Subtitle translation
- `validate_hebrew()`: Hebrew-specific validation

**Provider Routing**:
- **English/German**: DeepL (primary) → OpenAI (fallback)
- **Hebrew**: Microsoft Translator (primary) → OpenAI (fallback)

**Interactions**:
- ← `Pipeline`: Receives translation requests
- → `Database`: Updates translation status
- → `Evaluate`: Triggers quality assessment

### 5. Quality Evaluation (`scribe/evaluate.py`)
**Purpose**: Assess translation quality and authenticity
**Key Functions**:
- `evaluate_translation()`: Standard quality scoring
- `enhanced_hebrew_evaluation()`: Cultural context assessment
- `generate_quality_report()`: Detailed feedback

**Scoring Criteria**:
- Content Accuracy (40%)
- Speech Pattern Fidelity (30%)
- Cultural Context (15%)
- Overall Reliability (15%)

**Interactions**:
- ← `Pipeline`: Receives evaluation requests
- → `Database`: Stores quality scores
- → External: OpenAI GPT-4 for assessment

### 6. Database Manager (`scribe/database.py`)
**Purpose**: SQLite operations with connection pooling and subtitle-first architecture
**Key Classes**:
- `Database`: Main database interface
- `DatabaseManager`: Connection pooling for thread safety
- `PipelineDatabaseIntegration`: Subtitle segment coordination

**Key Tables**:
- `media_files`: Master file registry
- `processing_status`: Pipeline status tracking
- `subtitle_segments`: Word-level segments with timestamps
- `quality_evaluations`: Translation quality scores
- `errors`: Processing error log

**Key Views**:
- `transcripts`: Backward-compatible full transcript access
- `segment_quality`: Segment-level quality metrics

**Interactions**:
- ← All Components: Status updates and queries
- → `Backup`: Database snapshots
- → `Audit`: System validation
- → `SRTTranslator`: Segment-based subtitle generation

## 🌐 Web Viewer Components

### 1. Gallery Interface (`scribe-viewer/app/page.tsx`)
**Purpose**: Homepage showing all available interviews
**Features**:
- Grid/list view of interviews
- Search functionality
- Metadata display
- Navigation to individual viewers

**Data Source**: `manifest.json` (generated by build script)

### 2. Interview Viewer (`scribe-viewer/app/viewer/[id]/viewer-client.tsx`)
**Purpose**: Synchronized video and transcript viewing
**Features**:
- HTML5 video player with custom controls
- Multi-language transcript switching
- Auto-scrolling synchronized transcripts
- Click-to-seek functionality
- Subtitle overlay

**Key State Management**:
- Video playback state
- Active transcript cue tracking
- Language selection
- Subtitle visibility

### 3. Search Engine (`scribe-viewer/lib/search.ts`) - **PLANNED**
**Purpose**: Client-side full-text search
**Technology**: Fuse.js for fuzzy search
**Features**:
- Cross-interview search
- Contextual result snippets
- Timestamp deep-linking

### 4. Admin Backend (`scribe-viewer/app/api/admin/`) - **PLANNED**
**Purpose**: Metadata editing and system management
**Features**:
- Secure authentication
- Interview metadata editing
- Quality control interface
- System status monitoring

## 🔗 Data Integration Components

### 1. Manifest Builder (`scribe-viewer/scripts/build_manifest.py`) - **MISSING**
**Purpose**: Generate web viewer index from processing results
**Input**: `output/` directory with processed files
**Output**: `scribe-viewer/public/manifest.json`

**Key Functions**:
- Scan output directory structure
- Parse metadata from filenames
- Convert SRT to WebVTT format
- Generate searchable index
- Extract video metadata

### 2. Backup System (`scribe/backup.py`)
**Purpose**: System backup and disaster recovery
**Features**:
- Database snapshots
- File system archiving
- Incremental backups
- Restore functionality

**Interactions**:
- → `Database`: Backup database state
- → File System: Archive output files
- ← `CLI`: Triggered by user commands

### 3. Audit System (`scribe/audit.py`)
**Purpose**: System validation and health checks
**Features**:
- Database integrity checks
- File system validation
- Processing status audits
- Quality metric analysis

## 📊 Data Flow Diagram

```
Input Files → CLI Add → Database → Pipeline → Processing → Output → Manifest → Web Viewer
     ↓           ↓         ↓          ↓           ↓          ↓          ↓          ↓
[Media]    [file_id]  [pending]  [orchestrate] [APIs]   [results]  [index]   [research]
     ↓           ↓         ↓          ↓           ↓          ↓          ↓          ↓
   Local     SQLite    Status    Transcribe   External   Files    JSON      React
   Files     Record    Track     Translate    Services   System   Index     Interface
                                Evaluate
```

## 🔧 Configuration Components

### Environment Configuration
- **API Keys**: ElevenLabs, DeepL, OpenAI, Microsoft Translator
- **Paths**: Input, output, database, backup directories
- **Processing**: Worker counts, batch sizes, timeout values
- **Quality**: Evaluation thresholds and criteria

### Runtime Configuration
- **Pipeline Settings**: Language preferences, quality thresholds
- **Web Viewer**: Search parameters, UI preferences
- **Monitoring**: Logging levels, metric collection

## 🚨 Error Handling Components

### Retry Logic
- **Exponential Backoff**: API call failures
- **Circuit Breakers**: Service unavailability
- **Dead Letter Queues**: Failed processing jobs

### Recovery Systems
- **Automatic Retry**: Transient failures
- **Manual Recovery**: Stuck processing states
- **Rollback Capability**: Failed updates

## 🔍 Monitoring Components

### Logging
- **Structured Logging**: JSON format with correlation IDs
- **Log Levels**: DEBUG, INFO, WARNING, ERROR, CRITICAL
- **Log Rotation**: Size and time-based rotation

### Metrics (Planned)
- **Processing Rates**: Files per hour, success ratios
- **API Performance**: Response times, error rates
- **System Health**: Resource usage, queue depths

This component overview provides the foundation for understanding how all parts of the Scribe system work together to achieve the goal of historical interview preservation and accessibility.

